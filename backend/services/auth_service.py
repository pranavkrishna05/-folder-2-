# auth_service.py\nimport os\nfrom datetime import datetime, timedelta\nimport jwt\nfrom backend.models.user import User\nfrom werkzeug.security import generate_password_hash, check_password_hash\nfrom backend.repositories.user_repository import UserRepository\n\nclass AuthService:\n    def __init__(self, user_repository=None):\n        self.user_repository = user_repository if user_repository else UserRepository()\n\n    def register_user(self, data):\n        if self.user_repository.get_by_email(data['email']):\n            raise ValueError('Email must be unique')\n        password_hash = generate_password_hash(data['password'])\n        user = User(email=data['email'], password=password_hash)\n        self.user_repository.save(user)\n        return user\n\n    def login_user(self, data):\n        user = self.user_repository.get_by_email(data['email'])\n        if user and check_password_hash(user.password, data['password']):\n            return user\n        return None\n\n    def request_password_reset(self, email):\n        user = self.user_repository.get_by_email(email)\n        if not user:\n            raise ValueError('User not found')\n        expiration = datetime.utcnow() + timedelta(seconds=int(os.getenv('PASSWORD_RESET_EXPIRATION', 86400)))\n        token = jwt.encode({'email': user.email, 'exp': expiration}, os.getenv('SECRET_KEY'))\n        # Here you would send the token to the user's email\n        print(f'Password reset token: {token}')\n\n    def reset_password(self, token, new_password):\n        try:\n            data = jwt.decode(token, os.getenv('SECRET_KEY'), algorithms=['HS256'])\n            user = self.user_repository.get_by_email(data['email'])\n            if not user:\n                raise ValueError('Invalid token or user does not exist')\n            user.password = generate_password_hash(new_password)\n            self.user_repository.save(user)\n        except jwt.ExpiredSignatureError:\n            raise ValueError('Token has expired')\n        except jwt.InvalidTokenError:\n            raise ValueError('Invalid token')\n